# –ö–Ω–∏–≥–∞ –æ –¢–≠–ú-104: –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—É—á–∏—Ç—å—Å—è "—Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å" —Å —Ç–µ–ø–ª–æ—Å—á–µ—Ç—á–∏–∫–∞–º–∏ —Å–µ—Ä–∏–∏ –¢–≠–ú-104 –Ω–∞ –∏—Ö —Ä–æ–¥–Ω–æ–º —è–∑—ã–∫–µ ‚Äî —è–∑—ã–∫–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –æ–±–º–µ–Ω–∞. –ú—ã –ø—Ä–æ–π–¥–µ–º –≤–µ—Å—å –ø—É—Ç—å —Å –Ω—É–ª—è, —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏ –∏ –∂–∏–≤—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞.

## –ì–ª–∞–≤–∞ 1: –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±—â–µ–Ω–∏–µ?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –ø—Ä–∏–±–æ—Ä–∞. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ –≤–∑—è—Ç—å –∏ —Å–ø—Ä–æ—Å–∏—Ç—å: "–≠–π, –∫–∞–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞?". –ü—Ä–∏–±–æ—Ä –≤–∞—Å –Ω–µ –ø–æ–π–º–µ—Ç. –û–±—â–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ —Å—Ç—Ä–æ–≥–∏–º –ø—Ä–∞–≤–∏–ª–∞–º —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç (—á–∞—â–µ –≤—Å–µ–≥–æ RS-485 –∏–ª–∏ RS-232).

–ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Ö–æ–∂ –Ω–∞ —Ä–∞–¥–∏–æ—Å–≤—è–∑—å:
1. **–í—ã (–≤–µ–¥—É—â–∏–π)**: –§–æ—Ä–º–∏—Ä—É–µ—Ç–µ —á–µ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å ‚Äî –ø–∞–∫–µ—Ç —Å –∫–æ–º–∞–Ω–¥–æ–π.
2. **–í—ã (–≤–µ–¥—É—â–∏–π)**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —ç—Ç–æ—Ç –ø–∞–∫–µ—Ç –ø—Ä–∏–±–æ—Ä—É.
3. **–ü—Ä–∏–±–æ—Ä (–≤–µ–¥–æ–º—ã–π)**: –ü–æ–ª—É—á–∞–µ—Ç –≤–∞—à –ø–∞–∫–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É.
4. **–ü—Ä–∏–±–æ—Ä (–≤–µ–¥–æ–º—ã–π)**: –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–∞–∫–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Äî –ø–∞–∫–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤–∞–º.

–ù–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å —ç—Ç–∏ "–≤–æ–ø—Ä–æ—Å—ã" –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å "–æ—Ç–≤–µ—Ç—ã".

## –ì–ª–∞–≤–∞ 2: –ù–∞—à –ø–µ—Ä–≤—ã–π –¥–∏–∞–ª–æ–≥. –ö–æ–º–∞–Ω–¥–∞ "–¢—ã –Ω–∞ —Å–≤—è–∑–∏?"

–ü—Ä–µ–∂–¥–µ —á–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–µ—Ä—å–µ–∑–Ω–æ–µ, –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø—Ä–∏–±–æ—Ä –Ω–∞—Å —Å–ª—ã—à–∏—Ç. –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ ‚Äî –∫–æ–º–∞–Ω–¥–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### –®–∞–≥ 1: –°–æ–±–∏—Ä–∞–µ–º –Ω–∞—à "–≤–æ–ø—Ä–æ—Å" (–ø–∞–∫–µ—Ç)

–õ—é–±–æ–π –ø–∞–∫–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º, —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å—Ç–µ–π, –∫–∞–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:

| –ß–∞—Å—Ç—å –ø–∞–∫–µ—Ç–∞ | –ü—Ä–∏–º–µ—Ä (HEX) | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|--------------|----------|
| –ù–∞—á–∞–ª–æ (SIG) | 55 | –§–ª–∞–∂–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç: "–í–Ω–∏–º–∞–Ω–∏–µ, —è –Ω–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ–¥–∞—á—É!" |
| –ê–¥—Ä–µ—Å (ADDR) | 01 | –ù–æ–º–µ—Ä –ø—Ä–∏–±–æ—Ä–∞ –≤ —Å–µ—Ç–∏ (–æ—Ç 1 –¥–æ 240). –£ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–±–æ—Ä–∞ –æ–Ω —Å–≤–æ–π. |
| –ò–Ω–≤–µ—Ä—Å–Ω—ã–π –∞–¥—Ä–µ—Å (!ADDR) | FE | –¢–æ—Ç –∂–µ –∞–¥—Ä–µ—Å, –Ω–æ –≤—Å–µ –±–∏—Ç—ã –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã. –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫. |
| –ì—Ä—É–ø–ø–∞ –∫–æ–º–∞–Ω–¥ (CGRP) | 00 | –î–ª—è –∫–æ–º–∞–Ω–¥—ã "–¢—ã –Ω–∞ —Å–≤—è–∑–∏?" —ç—Ç–æ –≤—Å–µ–≥–¥–∞ 00. |
| –ö–æ–º–∞–Ω–¥–∞ (CMD) | 00 | –î–ª—è –∫–æ–º–∞–Ω–¥—ã "–¢—ã –Ω–∞ —Å–≤—è–∑–∏?" —ç—Ç–æ –≤—Å–µ–≥–¥–∞ 00. |
| –î–ª–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö (LEN) | 00 | –ú—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –¥–ª–∏–Ω–∞ 0. |
| –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ (CS) | AB | "–ú–∞–≥–∏—á–µ—Å–∫–æ–µ" —á–∏—Å–ª–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –ø–∞–∫–µ—Ç –¥–æ—à–µ–ª –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π. |

**–ö–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É (CS)?** –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ! –°–ª–æ–∂–∏—Ç–µ –≤—Å–µ –±–∞–π—Ç—ã –ø–∞–∫–µ—Ç–∞ (–æ—Ç SIG –¥–æ LEN), –∞ –æ—Ç –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—É–º–º—ã –≤–æ–∑—å–º–∏—Ç–µ —Ç–æ–ª—å–∫–æ –º–ª–∞–¥—à–∏–π –±–∞–π—Ç –∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –∞–¥—Ä–µ—Å–∞ 1**: 55 + 01 + FE + 00 + 00 + 00 = 154 (–≤ HEX). –ú–ª–∞–¥—à–∏–π –±–∞–π—Ç 54. –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –µ–≥–æ –∏ –ø–æ–ª—É—á–∞–µ–º AB.

### –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞–∫–µ—Ç –∏ —Å–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç

–ö–æ–≥–¥–∞ –º—ã –æ—Ç–ø—Ä–∞–≤–∏–º –Ω–∞—à –ø–∞–∫–µ—Ç, –ø—Ä–∏–±–æ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å. –ï–≥–æ –æ—Ç–≤–µ—Ç —Ç–æ–∂–µ –±—É–¥–µ—Ç –≤ "–∫–æ–Ω–≤–µ—Ä—Ç–µ":

| –ß–∞—Å—Ç—å –ø–∞–∫–µ—Ç–∞ | –ü—Ä–∏–º–µ—Ä (HEX) | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|--------------|----------|
| –ù–∞—á–∞–ª–æ (SIG) | AA | –û—Ç–≤–µ—Ç –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å AA. |
| –ê–¥—Ä–µ—Å (ADDR) | 01 | –ê–¥—Ä–µ—Å –ø—Ä–∏–±–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç. |
| –ò–Ω–≤–µ—Ä—Å–Ω—ã–π –∞–¥—Ä–µ—Å (!ADDR) | FE | –ï–≥–æ –∏–Ω–≤–µ—Ä—Å–Ω—ã–π –∞–¥—Ä–µ—Å. |
| ...–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ | ... | ... |
| –î–∞–Ω–Ω—ã–µ (DATA) | 54 45 4D ... | –ê –≤–æ—Ç —Ç—É—Ç —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ - –∏–º—è –ø—Ä–∏–±–æ—Ä–∞! |

–ï—Å–ª–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å AA –∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º, ‚Äî —É—Ä–∞, —Å–≤—è–∑—å –µ—Å—Ç—å!

## –®–∞–≥ –∑–∞ —à–∞–≥–æ–º –≤ –∫–æ–¥–µ

–ù–∏–∂–µ –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞: –æ–¥–∏–Ω –Ω–∞ Python –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ä—Ç–æ–º, –∏ –≤—Ç–æ—Ä–æ–π –Ω–∞ React, –∫–æ—Ç–æ—Ä—ã–π –∏–º–∏—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

### –ü—Ä–∏–º–µ—Ä 1: Python (—Ä–µ–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–æ—Ä—Ç–æ–º)

```python
import serial
import time
import sys

# --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º ---

def calculate_checksum(packet):
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É –¥–ª—è –ø–∞–∫–µ—Ç–∞ –¢–≠–ú-104."""
    return (~sum(packet) & 255)

def create_request(address, command_group, command, data=None):
    """–°–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø–∞–∫–µ—Ç –∑–∞–ø—Ä–æ—Å–∞."""
    if data is None:
        data = []
    
    # –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∞–¥—Ä–µ—Å
    inv_address = ~address & 255
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç
    packet = [0x55, address, inv_address, command_group, command, len(data)]
    packet.extend(data)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É
    packet.append(calculate_checksum(packet))
    
    return bytearray(packet)

def parse_response(response_bytes):
    """–†–∞–∑–±–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–∏–±–æ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å."""
    if not response_bytes or response_bytes[0] != 0xAA:
        print("–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–∞–π—Ç –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç –ø—É—Å—Ç.")
        return None

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É
    expected_cs = calculate_checksum(response_bytes[:-1])
    received_cs = response_bytes[-1]

    if expected_cs != received_cs:
        print(f"–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞! –û–∂–∏–¥–∞–ª–∏: {expected_cs:02X}, –ø–æ–ª—É—á–∏–ª–∏: {received_cs:02X}")
        return None
        
    address = response_bytes[1]
    length = response_bytes[5]
    data = response_bytes[6:-1]

    if len(data) != length:
        print("–û—à–∏–±–∫–∞: –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–ª–∏–Ω–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π –≤ –ø–∞–∫–µ—Ç–µ.")
        return None

    return {
        "address": address,
        "command_group": response_bytes[3],
        "command": response_bytes[4],
        "length": length,
        "data": data
    }

# --- –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ---

def main():
    # –ó–ê–ú–ï–ù–ò–¢–ï 'COM3' –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç, –∞ 1 –Ω–∞ –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –ø—Ä–∏–±–æ—Ä–∞
    # –î–ª—è Linux/macOS –ø–æ—Ä—Ç –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∫–∞–∫ '/dev/ttyUSB0'
    try:
        PORT = 'COM3'
        BAUDRATE = 9600
        DEVICE_ADDRESS = 1
    except IndexError:
        print("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: python script.py <PORT> <BAUDRATE> <ADDRESS>")
        return

    try:
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º COM-–ø–æ—Ä—Ç
        ser = serial.Serial(PORT, int(BAUDRATE), timeout=2)
        print(f"–ü–æ—Ä—Ç {PORT} –æ—Ç–∫—Ä—ã—Ç, —Å–∫–æ—Ä–æ—Å—Ç—å {BAUDRATE}.")
    except serial.SerialException as e:
        print(f"–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç {PORT}. {e}")
        return

    # --- –®–ê–ì 1: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ---
    print("\n--- –®–∞–≥ 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (00 00) ---")
    
    # –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å
    request_packet = create_request(DEVICE_ADDRESS, 0x00, 0x00)
    print(f"–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞–∫–µ—Ç: {' '.join(f'{b:02X}' for b in request_packet)}")

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏ —á–∏—Ç–∞–µ–º –æ—Ç–≤–µ—Ç
    ser.write(request_packet)
    time.sleep(0.5) # –î–∞–µ–º –ø—Ä–∏–±–æ—Ä—É –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç
    response_bytes = ser.read(128) # –ß–∏—Ç–∞–µ–º –¥–æ 128 –±–∞–π—Ç

    if not response_bytes:
        print("!!! –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –∞–¥—Ä–µ—Å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å.")
        ser.close()
        return
        
    print(f"–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: {' '.join(f'{b:02X}' for b in response_bytes)}")

    # --- –®–ê–ì 2: –†–∞–∑–±–æ—Ä –æ—Ç–≤–µ—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ ---
    print("\n--- –®–∞–≥ 2: –†–∞–∑–±–æ—Ä –æ—Ç–≤–µ—Ç–∞ ---")
    parsed = parse_response(response_bytes)

    if parsed:
        print("–û—Ç–≤–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω! –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤–µ—Ä–Ω–∞.")
        try:
            # –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ (–∏–º—è –ø—Ä–∏–±–æ—Ä–∞) –∏–∑ ASCII
            device_name = parsed["data"].decode('ascii')
            print(f"–ò–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: {device_name}")
            
            if "M" in device_name:
                print("–û–ø—Ä–µ–¥–µ–ª–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª: –¢–≠–ú-104–ú (–Ω–æ–≤—ã–π)")
            else:
                print("–û–ø—Ä–µ–¥–µ–ª–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª: –¢–≠–ú-104 (—Å—Ç–∞—Ä—ã–π)")
        except UnicodeDecodeError:
            print("–ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.")
    else:
        print("!!! –ü–æ–ª—É—á–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.")

    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç
    ser.close()
    print(f"\n–ü–æ—Ä—Ç {PORT} –∑–∞–∫—Ä—ã—Ç.")

if __name__ == "__main__":
    main()
```

### –ü—Ä–∏–º–µ—Ä 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```python
from test104 import TEM104_Serial_Client

def simple_identification():
    """–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏."""
    
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç –¥–ª—è COM-–ø–æ—Ä—Ç–∞
    client = TEM104_Serial_Client(
        port='COM3',      # –í–∞—à COM-–ø–æ—Ä—Ç
        baudrate=9600,    # –°–∫–æ—Ä–æ—Å—Ç—å
        address=1         # –ê–¥—Ä–µ—Å —Å—á–µ—Ç—á–∏–∫–∞
    )
    
    try:
        # –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è
        client.connect()
        print("–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!")
        
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª
        protocol = client.auto_detect_protocol()
        print(f"–û–ø—Ä–µ–¥–µ–ª–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª: {protocol}")
        
        # –ß–∏—Ç–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
        data = client.read_all_data()
        print("\n--- –î–∞–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∞ ---")
        print(f"Q (–≠–Ω–µ—Ä–≥–∏—è): {data.get('Q', '---'):.3f}")
        print(f"M1 (–ú–∞—Å—Å–∞):  {data.get('M1', '---'):.3f}")
        print(f"T1 (–¢–µ–º–ø.):  {data.get('T1', '---'):.2f} ¬∞C")
        print(f"T2 (–¢–µ–º–ø.):  {data.get('T2', '---'):.2f} ¬∞C")
        print(f"G1 (–†–∞—Å—Ö–æ–¥): {data.get('G1', '---'):.3f} –º¬≥/—á")
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
    finally:
        client.disconnect()
        print("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ.")

if __name__ == "__main__":
    simple_identification()
```

## –ì–ª–∞–≤–∞ 3: –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –∑–Ω–∞–µ–º, —á—Ç–æ –ø—Ä–∏–±–æ—Ä –Ω–∞—Å —Å–ª—ã—à–∏—Ç, –¥–∞–≤–∞–π—Ç–µ –Ω–∞—É—á–∏–º—Å—è —á–∏—Ç–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∫–æ–º–∞–Ω–¥

| –ì—Ä—É–ø–ø–∞ | –ö–æ–¥ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----|------------|
| 0x00 | 00 | –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
| 0x0F | 01 | –ß—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (–∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ) |
| 0x0F | 02 | –ß—Ç–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (RTC) |
| 0x0C | 01 | –ß—Ç–µ–Ω–∏–µ –û–ó–£ (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã) |

### –ü—Ä–∏–º–µ—Ä: –ß—Ç–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

```python
def read_time_example():
    """–ü—Ä–∏–º–µ—Ä —á—Ç–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Å —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –¢–≠–ú-104."""
    
    client = TEM104_Serial_Client(port='COM3', baudrate=9600, address=1)
    
    try:
        client.connect()
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª
        protocol = client.auto_detect_protocol()
        print(f"–ü—Ä–æ—Ç–æ–∫–æ–ª: {protocol}")
        
        # –ß–∏—Ç–∞–µ–º –≤—Ä–µ–º—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏
        if protocol in ['ARVAS_M', 'ARVAS_M1']:
            # –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ - –≤—Ä–µ–º—è –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            packet = client._create_packet(0x0F, 0x02, b'\x00\x07')
        elif protocol == 'ARVAS_LEGACY':
            # –°—Ç–∞—Ä—ã–µ –º–æ–¥–µ–ª–∏ - –≤—Ä–µ–º—è –≤ BCD
            packet = client._create_packet(0x0F, 0x02, b'\x10\x0A')
        else:
            print("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª")
            return
            
        response = client._send_and_receive(packet)
        if response:
            print(f"–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–æ: {response.hex()}")
            
    finally:
        client.disconnect()
```

## –ì–ª–∞–≤–∞ 4: –†–∞–∑–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö - –∫–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –Ω–∞–º –æ—Ç–≤–µ—Ç–∏–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏

–†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¢–≠–ú-104 —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø–∞–º—è—Ç–∏:

#### ARVAS_M1 (TEM-104M-1)
- **–ò—Ç–æ–≥–∏**: –∞–¥—Ä–µ—Å 0x0180
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ**: –∞–¥—Ä–µ—Å 0x4000
- **–í—Ä–µ–º—è**: –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

#### ARVAS_LEGACY (TEM-104)
- **–ò—Ç–æ–≥–∏**: –∞–¥—Ä–µ—Å 0x0200  
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ**: –∞–¥—Ä–µ—Å 0x2200
- **–í—Ä–µ–º—è**: BCD —Ñ–æ—Ä–º–∞—Ç

### –ü—Ä–∏–º–µ—Ä —Ä–∞–∑–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```python
import struct

def parse_temperature_data(raw_data, offset):
    """–†–∞–∑–±–æ—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏–∑ 4 –±–∞–π—Ç (float)."""
    try:
        temp_bytes = raw_data[offset:offset+4]
        temperature = struct.unpack('>f', temp_bytes)[0]
        return temperature
    except:
        return 0.0

def parse_energy_data(raw_data, offset):
    """–†–∞–∑–±–æ—Ä —ç–Ω–µ—Ä–≥–∏–∏ –∏–∑ 4 –±–∞–π—Ç (float)."""
    try:
        energy_bytes = raw_data[offset:offset+4]
        energy = struct.unpack('>f', energy_bytes)[0]
        return energy
    except:
        return 0.0

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
raw_response = b'\x00\x00\x00\x42\x00\x00\x00\x43'  # –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
temp1 = parse_temperature_data(raw_response, 0)
temp2 = parse_temperature_data(raw_response, 4)
print(f"T1: {temp1:.2f}¬∞C, T2: {temp2:.2f}¬∞C")
```

## –ì–ª–∞–≤–∞ 5: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

### 1. –û—Ç–ª–∞–¥–∫–∞ —Å–≤—è–∑–∏
```python
def debug_communication():
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Å–≤—è–∑–∏ —Å –ø—Ä–∏–±–æ—Ä–æ–º."""
    
    client = TEM104_Serial_Client(port='COM3', baudrate=9600, address=1)
    
    try:
        client.connect()
        print("‚úì –ü–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç")
        
        # –¢–µ—Å—Ç 1: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        protocol = client.auto_detect_protocol()
        if protocol:
            print(f"‚úì –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω: {protocol}")
        else:
            print("‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª")
            return
            
        # –¢–µ—Å—Ç 2: –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        data = client.read_all_data()
        if data:
            print("‚úì –î–∞–Ω–Ω—ã–µ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")
            for key, value in data.items():
                print(f"  {key}: {value}")
        else:
            print("‚úó –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ")
            
    except Exception as e:
        print(f"‚úó –û—à–∏–±–∫–∞: {e}")
    finally:
        client.disconnect()
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```python
def check_connection(port, baudrate, address):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–∏–±–æ—Ä—É."""
    
    try:
        client = TEM104_Serial_Client(port=port, baudrate=baudrate, address=address)
        client.connect()
        
        # –ü—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª
        protocol = client.auto_detect_protocol()
        if protocol:
            print(f"‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ OK! –ü—Ä–æ—Ç–æ–∫–æ–ª: {protocol}")
            return True
        else:
            print("‚úó –ü—Ä–∏–±–æ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏")
            return False
            
    except Exception as e:
        print(f"‚úó –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
        return False
    finally:
        client.disconnect()
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –æ—Å–Ω–æ–≤—ã –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¢–≠–ú-104! –í—ã –º–æ–∂–µ—Ç–µ:
- ‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
- ‚úÖ –†–∞–∑–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å—á–µ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:
1. –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –≤–∞—à–µ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞
2. –ü–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
3. –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

–£–¥–∞—á–∏ –≤ —Ä–∞–±–æ—Ç–µ —Å —Ç–µ–ø–ª–æ—Å—á–µ—Ç—á–∏–∫–∞–º–∏! üî• 